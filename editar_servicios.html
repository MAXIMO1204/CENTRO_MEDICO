<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar y Administrar Servicios</title>
    <style>
        /* Estilos de tarjetas y formulario */
        /* Añade tus estilos CSS personalizados aquí si es necesario */
    </style>
</head>
<body>
    <div class="contenido-servicios">
        <section id="servicios" class="servicios">
            <h2>SERVICIOS</h2>
            <div class="main" id="servicios-lista">
                <!-- Tarjetas de servicios se generarán aquí dinámicamente -->
            </div>
            <div>
                <h3>Agregar Nuevo Servicio</h3>
                <input type="text" id="nuevo-titulo" placeholder="Título del servicio">
                <textarea id="nueva-descripcion" placeholder="Descripción del servicio"></textarea>
                <button onclick="crearServicio()">Agregar Servicio</button>
            </div>
        </section>
    </div>

    <script>
        // Función para cargar los servicios desde el backend
        async function cargarServicios() {
            const response = await fetch('http://localhost:3000/servicios');
            const servicios = await response.json();
            const serviciosLista = document.getElementById('servicios-lista');
            serviciosLista.innerHTML = '';

            servicios.forEach(servicio => {
                const divServicio = document.createElement('div');
                divServicio.className = 'card';
                divServicio.innerHTML = `
                    <div class="image">
                        <img src="img/${servicio.id}.png">
                    </div>
                    <div class="title">
                        <h1>${servicio.titulo}</h1>
                    </div>
                    <div class="des">
                        <p>${servicio.descripcion}</p>
                    </div>
                    <div>
                        <button onclick="mostrarFormulario(${servicio.id})">Editar</button>
                        <button onclick="eliminarServicio(${servicio.id})">Eliminar</button>
                    </div>
                    <div class="edit-form" id="edit-form-${servicio.id}">
                        <input type="text" id="titulo-${servicio.id}" value="${servicio.titulo}">
                        <textarea id="descripcion-${servicio.id}">${servicio.descripcion}</textarea>
                        <button onclick="actualizarServicio(${servicio.id})">Guardar</button>
                    </div>
                    <br>
                `;
                serviciosLista.appendChild(divServicio);
            });
        }

        // Función para mostrar el formulario de edición
        function mostrarFormulario(id) {
            const form = document.getElementById(`edit-form-${id}`);
            form.style.display = 'block';
        }

        // Función para crear un nuevo servicio
        async function crearServicio() {
            const nuevoTitulo = document.getElementById('nuevo-titulo').value;
            const nuevaDescripcion = document.getElementById('nueva-descripcion').value;

            const response = await fetch('http://localhost:3000/servicios', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    titulo: nuevoTitulo,
                    descripcion: nuevaDescripcion
                })
            });

            const data = await response.json();
            alert(data.message);
            // Recargar la lista de servicios después de la creación
            cargarServicios();
        }

        // Función para actualizar un servicio existente
        async function actualizarServicio(id) {
            const nuevoTitulo = document.getElementById(`titulo-${id}`).value;
            const nuevaDescripcion = document.getElementById(`descripcion-${id}`).value;

            const response = await fetch(`http://localhost:3000/servicios/${id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    titulo: nuevoTitulo,
                    descripcion: nuevaDescripcion
                })
            });

            const data = await response.json();
            alert(data.message);
            // Ocultar el formulario después de guardar
            const form = document.getElementById(`edit-form-${id}`);
            form.style.display = 'none';
            // Recargar la lista de servicios después de la actualización
            cargarServicios();
        }

        // Función para eliminar un servicio
        async function eliminarServicio(id) {
            if (confirm('¿Estás seguro de que quieres eliminar este servicio?')) {
                const response = await fetch(`http://localhost:3000/servicios/${id}`, {
                    method: 'DELETE'
                });

                const data = await response.json();
                alert(data.message);
                // Recargar la lista de servicios después de la eliminación
                cargarServicios();
            }
        }

        // Cargar los servicios al cargar la página
        cargarServicios();
    </script>
</body>
</html>
